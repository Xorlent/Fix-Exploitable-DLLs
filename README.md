# Fix-Exploitable-DLLs
PowerShell script to find, report, and mitigate (where possible) EXEs with exploitable DLLs  

### Summary
  _If a vulnerable Microsoft DLL is properly code-signed, the script will auto-remediate the vulnerability_  
  Once tested successfully, I recommend running this tool on your organization's standard Windows  
  desktop deployment image, verifying all works well, then use the resulting yyyy-MM-dd_HH-mm_New.xml  
  file to deploy mitigations to the fleet via GPO (required if other Defender settings are GPO-managed), or using:  
  ```Set-ProcessMitigation -PolicyFilePath .\yyyy-MM-dd_HH-mm_New.xml```

### Preparation
  - Take a full OS backup if necessary (ie. if this is not a fresh deployment image or test box)

### Installing and running
  - Download RemediateDLLHijack.ps1
  - Right-click on the downloaded file and select Properties
  - Click "Unblock," then "OK"
  - Open an Administrator Powershell window
  - Run RemediateDLLHijack.ps1
    - Note, this process takes a while, as it must iterate through all Microsoft paths to check for signed DLLs.  Expect about six hours of runtime on a modern computer.
    - You may see a number of "WARNING: Error while setting ..." console messages.  These can be safely ignored.

### Reading the report
  - After a completed run, find the CSV file and open with your favorite editor
  - Column 1 indicates whether the tool remediated the vulnerability or not
  - Any entires listes as, "AUTO-MITIGATED!" were mitigated using [Microsoft Process Mitigation](https://learn.microsoft.com/en-us/powershell/module/processmitigations/?view=windowsserver2022-ps)
  - Any entries listed as, "INTERVENTION REQD" are likely 3rd party DLLs you should evaluate
    - Note: "INTERVENTION REQD" executables that load DLLs found during your scan may not exist on your machine.  The results are included to ensure full coverage.

### A remediated executable now no longer works
  - Open an Administrator Powershell window
  - For each executable you want to allow unsigned DLL loading on (exchange exename.exe for the actual executable name):  
    ```Set-ProcessMitigation -Disable MicrosoftSignedOnly -Name exename.exe```

### I need to roll back ALL changes
  - Navigate to the folder where you ran the tool
  - Open the CSV file and filter out all blank entries from the "Rollback Cmd" column
  - Copy the "Rollback Cmd" data from all of the populated rows and paste into notepad, saving as a text file
  - Open an Administrator Powershell window
  - Copy/paste the commands from your text file to revert all changes

### None of this works.  What now?
#### Broken machine?
  - Restore from backup
#### Script not working correctly?
  - If your Windows install is not 100% default (\Windows, \Program Files, \ProgramData folders are not all located on the C: drive), you will have to manually edit the script to handle this scenario

#### This project uses [Wietze's Hijacklibs](https://github.com/wietze/HijackLibs) data to scan for vulnerabilities.  Many thanks!
